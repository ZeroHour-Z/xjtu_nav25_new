# RMUL 状态行为树
# 功能说明：
# 1. 本树依赖 handler_node 下发的布尔参数：standby/supply/occupy_point/repel
# 2. 根节点为 Selector，按从上到下优先级匹配第一个成功分支
# 3. 坐标均为 map 坐标系
tree:
  name: RMUL_tree
  root:
    type: Selector
    name: RMUL状态决策
    params:
      memory: false
    children:
      # standby：原地待命，不下发任何导航目标
      - type: Sequence
        name: standby_原地待命
        params:
          memory: false
        children:
          - type: ParamBoolCondition
            name: standby状态?
            params:
              param: "standby"
              expected: true
              latched_ok: false
          - type: PublishString
            name: 发布standby
            params:
              topic: "/sentry_actions"
              data: "STANDBY"
              publish_every_tick: false
          - type: Wait
            name: 待命等待
            params:
              duration_s: 999999.0

      # supply：回到补给点（如需修改，替换下方 x/y/yaw）
      - type: Sequence
        name: supply_回补给点
        params:
          memory: false
        children:
          - type: ParamBoolCondition
            name: supply状态?
            params:
              param: "supply"
              expected: true
              latched_ok: false
          - type: PublishString
            name: 发布supply
            params:
              topic: "/sentry_actions"
              data: "SUPPLY"
              publish_every_tick: false
          - type: NavigateToPoseAction
            name: 去补给点
            params:
              server_name: "navigate_to_pose"
              frame_id: "map"
              x: -2.6
              y: -1.3
              yaw: 0.0
              timeout_s: 120

      # occupy_point：固定去占点位 [-6.3, -4.31, 0]
      - type: Sequence
        name: occupy_point_占点
        params:
          memory: false
        children:
          - type: ParamBoolCondition
            name: occupy_point状态?
            params:
              param: "occupy_point"
              expected: true
              latched_ok: false
          - type: PublishString
            name: 发布occupy_point
            params:
              topic: "/sentry_actions"
              data: "OCCUPY_POINT"
              publish_every_tick: false
          - type: NavigateToPoseAction
            name: 去占点位
            params:
              server_name: "navigate_to_pose"
              frame_id: "map"
              x: -6.3
              y: -4.3
              yaw: 0.0
              timeout_s: 120

      # repel：按两个点顺序执行驱赶（点1 -> 短暂停留 -> 点2）
      # 如需改为你的赛场点位，仅修改两个 NavigateToPoseAction 的 x/y/yaw
      - type: Sequence
        name: repel_双点驱赶
        params:
          memory: false
        children:
          - type: ParamBoolCondition
            name: repel状态?
            params:
              param: "repel"
              expected: true
              latched_ok: false
          - type: PublishString
            name: 发布repel
            params:
              topic: "/sentry_actions"
              data: "REPEL"
              publish_every_tick: false
          - type: NavigateToPoseAction
            name: repel点1
            params:
              server_name: "navigate_to_pose"
              frame_id: "map"
              x: 4.2
              y: -2.0
              yaw: 0.0
              timeout_s: 120
          - type: Wait
            name: repel点1停留
            params:
              duration_s: 1.0
          - type: NavigateToPoseAction
            name: repel点2
            params:
              server_name: "navigate_to_pose"
              frame_id: "map"
              x: -7.0
              y: -5.0
              yaw: 0.0
              timeout_s: 120

      # 兜底分支：没有任何状态命中时，短等待后下一帧继续评估
      - type: Wait
        name: 未匹配状态_空转
        params:
          duration_s: 0.2
